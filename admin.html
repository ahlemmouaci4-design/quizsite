<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Oncology Admin | Pro Reveal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --purple-btn: #d8b4fe; /* بنفسجي فاتح */
            --purple-dark: #9d50bb;
            --pink: #ec4899;
            --glass: rgba(255, 255, 255, 0.08);
        }
        
        body { 
            margin: 0; font-family: 'Poppins', sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center; 
            background: #050505; color: #fff; overflow: hidden;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
        }
        
        .admin-ui { 
            width: 85%; max-width: 900px; max-height: 90vh; background: var(--glass); 
            backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.1); 
            border-radius: 35px; padding: 40px; text-align: center; position: relative;
        }

        /* قنبلة الحماس */
        #bomb-element {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 100px; height: 100px; background: radial-gradient(circle, #fff, var(--purple-btn));
            border-radius: 50%; z-index: 1000; display: none; box-shadow: 0 0 50px var(--purple-btn);
        }

        .inflate-and-burst {
            display: block !important;
            animation: inflate 2.5s cubic-bezier(0.6, 0.04, 0.98, 0.33) forwards;
        }

        @keyframes inflate {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            40% { transform: translate(-50%, -50%) scale(1.5); filter: blur(2px); }
            80% { transform: translate(-50%, -50%) scale(2.5); filter: blur(5px); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(40); opacity: 0; } /* الانفجار */
        }

        /* الأزرار الاحترافية */
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; }
        
        .btn-pro {
            background: var(--purple-btn); color: #2e1065; border: none; padding: 18px; 
            border-radius: 20px; font-weight: 800; font-size: 1rem; cursor: pointer;
            box-shadow: 0 6px 0 #a78bfa; /* تأثير العمق */
            transition: all 0.1s ease; position: relative; top: 0;
        }

        .btn-pro:active {
            top: 4px; /* النزول للأسفل عند الضغط */
            box-shadow: 0 2px 0 #a78bfa;
        }

        .btn-pro:hover { background: #e9d5ff; }

        /* تنسيق الفرق */
        .teams-container { display: flex; justify-content: center; gap: 25px; margin: 30px 0; }
        .team-slot { 
            padding: 25px; border-radius: 25px; background: rgba(0,0,0,0.3); 
            width: 45%; border: 1px solid rgba(255,255,255,0.1); transition: 1s; 
        }
        .score-val { font-size: 5rem; font-weight: 800; display: none; margin-top: 10px; color: #fff; }
        .winner-active { border: 3px solid #ffd700; box-shadow: 0 0 40px rgba(255,215,0,0.4); transform: translateY(-10px); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="bomb-element"></div>

    <div class="admin-ui" id="ui-card">
        <h2 style="margin: 0; opacity: 0.5; letter-spacing: 3px;">ONCOLOGY SHOW 2026</h2>
        <div id="timer-display" style="font-size: 6rem; font-weight: 800;">01:00</div>

        <div class="teams-container">
            <div class="team-slot" id="card-pink" style="border-top: 8px solid var(--pink);">
                <h3 style="color: var(--pink); margin: 0;">Team Rose</h3>
                <div id="name-pink" style="font-size: 1.4rem; font-weight: 600;">...</div>
                <div id="score-pink" class="score-val">0</div>
            </div>

            <div class="team-slot" id="card-purple" style="border-top: 8px solid var(--purple-dark);">
                <h3 style="color: var(--purple-dark); margin: 0;">Team Violette</h3>
                <div id="name-purple" style="font-size: 1.4rem; font-weight: 600;">...</div>
                <div id="score-purple" class="score-val">0</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-pro" onclick="triggerAction('start')">START</button>
            <button class="btn-pro" onclick="animateBomb()">RESULTS</button>
            <button class="btn-pro" onclick="triggerAction('reset')">RESET</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = { databaseURL: "https://quiz-8016b-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref('competition');
        let interval;

        db.on('value', snap => {
            const data = snap.val(); if(!data) return;
            document.getElementById('name-pink').innerText = data.teamPink || "En attente...";
            document.getElementById('name-purple').innerText = data.teamPurple || "En attente...";

            if(data.status === 'start') startTimer(data.startTime);
            if(data.showResults) executeFinalReveal(data);
            if(data.status === 'waiting') location.reload();
        });

        function startTimer(st) {
            clearInterval(interval);
            interval = setInterval(() => {
                const rem = 60 - Math.floor((Date.now() - st) / 1000);
                document.getElementById('timer-display').innerText = `00:${rem > 0 ? rem.toString().padStart(2,'0') : '00'}`;
            }, 1000);
        }

        // تحريك القنبلة قبل إرسال الأمر لـ Firebase
        function animateBomb() {
            const bomb = document.getElementById('bomb-element');
            bomb.classList.add('inflate-and-burst');
            
            // ننتظر حتى يغطي الانفجار الشاشة (بعد 2 ثانية) ثم نرسل الأمر
            setTimeout(() => {
                db.update({ showResults: true });
            }, 2000);
        }

        function executeFinalReveal(data) {
            document.getElementById('timer-display').classList.add('hidden');
            const sP = data.scorePink || 0;
            const sV = data.scorePurple || 0;

            const elP = document.getElementById('score-pink');
            const elV = document.getElementById('score-purple');
            
            elP.innerText = sP; elV.innerText = sV;
            elP.style.display = 'block'; elV.style.display = 'block';

            // انفجار القصاصات (Confetti) بلون الفريق الفائز
            let color = (sP > sV) ? '#ec4899' : (sV > sP ? '#9d50bb' : ['#ec4899', '#9d50bb']);
            confetti({
                particleCount: 300, spread: 100, origin: { y: 0.5 },
                colors: Array.isArray(color) ? color : [color, '#ffffff']
            });

            if(sP > sV) document.getElementById('card-pink').classList.add('winner-active');
            else if(sV > sP) document.getElementById('card-purple').classList.add('winner-active');
        }

        function triggerAction(act) {
            if(act === 'start') db.update({ status: 'start', startTime: firebase.database.ServerValue.TIMESTAMP });
            else if(act === 'reset') db.set({ status: 'waiting' });
        }
    </script>
</body>
</html>
