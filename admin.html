
<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oncology Quiz | ADMIN CONTROL</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --purple: #9d50bb; --pink: #ec4899; 
            --glass-bg: rgba(255, 255, 255, 0.08); --glass-border: rgba(255, 255, 255, 0.15); 
        }

        body { 
            margin: 0; font-family: 'Poppins', sans-serif; min-height: 100vh; 
            display: flex; align-items: center; justify-content: center; 
            background: #050505; color: #fff;
            background-image: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('https://images.pexels.com/photos/4225880/pexels-photo-4225880.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            background-size: cover; background-position: center;
        }

        .main-container { width: 95%; max-width: 800px; display: flex; flex-direction: column; gap: 20px; }

        .glass-panel { 
            background: var(--glass-bg); backdrop-filter: blur(25px); 
            border: 1px solid var(--glass-border); border-radius: 30px; 
            padding: 30px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); 
        }

        /* عداد الوقت الخاص بكل سؤال */
        #question-timer {
            font-size: 3rem; font-weight: 900; color: #f1c40f;
            margin: 10px 0; text-shadow: 0 0 20px rgba(241, 196, 15, 0.5);
        }

        .status-grid { display: flex; gap: 15px; margin-bottom: 20px; }
        .team-card { flex: 1; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 20px; padding: 15px; }
        .score-val { font-size: 3rem; font-weight: 900; margin: 5px 0; }

        .correction-box {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;
            background: rgba(0,0,0,0.3); padding: 20px; border-radius: 20px; border: 1px dashed var(--glass-border);
        }

        .team-ans { padding: 15px; border-radius: 12px; font-size: 0.9rem; background: rgba(255,255,255,0.03); min-height: 60px; }

        .controls { display:flex; gap:10px; justify-content:center; margin-top: 20px; }
        
        .glass-btn { 
            padding: 12px 25px; border-radius: 12px; border: 2px solid var(--glass-border); 
            background: transparent; color: #fff; font-weight: 700; cursor: pointer; transition: 0.3s;
            text-transform: uppercase; font-size: 0.8rem;
        }
        .btn-red { border-color: #ff4b2b; color: #ff4b2b; }
        .btn-green { border-color: #10b981; color: #10b981; }
        .btn-blue { border-color: #3b82f6; color: #3b82f6; }
        .glass-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }

        #winner-overlay {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(60px);
            display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 2000;
        }

        .winner-frame {
            padding: 50px; border-radius: 40px; border: 10px solid; text-align: center;
            background: rgba(255,255,255,0.05); box-shadow: 0 0 80px rgba(0,0,0,0.5);
        }

        .shining-text {
            font-size: 5rem; font-weight: 900; text-transform: uppercase;
            background: linear-gradient(90deg, transparent, #fff, transparent);
            background-size: 200% 100%; -webkit-background-clip: text; background-clip: text;
            animation: shine 3s infinite linear;
        }
        @keyframes shine { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="glass-panel">
            <h2 id="question-header" style="font-size: 1rem; opacity: 0.6; margin: 0;">QUESTION 1 / 10</h2>
            <div id="question-timer">01:00</div>
            
            <div class="status-grid">
                <div class="team-card">
                    <span style="color:var(--pink); font-size:0.7rem; font-weight:800;">TEAM PINK</span>
                    <div class="score-val" id="score-p">0</div>
                </div>
                <div class="team-card">
                    <span style="color:var(--purple); font-size:0.7rem; font-weight:800;">TEAM PURPLE</span>
                    <div class="score-val" id="score-v">0</div>
                </div>
            </div>

            <div class="controls">
                <button class="glass-btn btn-red" onclick="resetComp()">Réinitialiser</button>
                <button class="glass-btn btn-green" id="next-q-btn" onclick="triggerNextQuestion()">Lancer Question 1</button>
                <button class="glass-btn btn-blue" onclick="showFinal()">Terminer & Résultats</button>
            </div>
        </div>

        <div class="glass-panel" id="correction-area">
            <h3 style="font-size: 0.8rem; color: #f1c40f;">RÉPONSES EN DIRECT (PHASE 1)</h3>
            <div class="correction-box">
                <div class="team-ans">
                    <div style="color:var(--pink); font-weight:bold; margin-bottom:5px;">PINK TEAM:</div>
                    <div id="ans-pink">...</div>
                </div>
                <div class="team-ans">
                    <div style="color:var(--purple); font-weight:bold; margin-bottom:5px;">PURPLE TEAM:</div>
                    <div id="ans-purple">...</div>
                </div>
            </div>
        </div>
    </div>

    <div id="winner-overlay">
        <div id="winner-frame" class="winner-frame">
            <h3 style="letter-spacing: 10px; color: #fff;">VICTOIRE</h3>
            <h1 id="winner-name" class="shining-text"></h1>
            <h2 id="winner-score" style="color: #fff; opacity: 0.8;"></h2>
            <button class="glass-btn" style="margin-top:20px; border-color:#fff;" onclick="resetComp()">Menu Principal</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = { databaseURL: "https://quiz-8016b-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref('competition');

        let currentQ = 0;
        let timerInt = null;

        function resetComp() {
            if(confirm("Réinitialiser ?")) {
                db.set({
                    status: 'waiting', teamPink: "", teamPurple: "",
                    scorePink: 0, scorePurple: 0, currentQuestion: 0,
                    startTime: 0, showResults: false, answers: {}
                }).then(() => location.reload());
            }
        }

        // إطلاق السؤال الموالي وتصفير العداد
        function triggerNextQuestion() {
            currentQ++;
            if(currentQ > 10) return alert("Fin du quiz!");
            
            db.update({
                status: 'start',
                currentQuestion: currentQ,
                startTime: Date.now() // ضبط وقت البداية الجديد للعداد
            });
        }

        function showFinal() { db.update({ showResults: true }); }

        db.on('value', snap => {
            const d = snap.val(); if(!d) return;

            currentQ = d.currentQuestion || 0;
            document.getElementById('score-p').innerText = d.scorePink || 0;
            document.getElementById('score-v').innerText = d.scorePurple || 0;
            document.getElementById('question-header').innerText = `QUESTION ${currentQ} / 10`;
            document.getElementById('next-q-btn').innerText = `Lancer Question ${currentQ + 1}`;

            // تحديث العداد
            if(d.status === 'start' && d.startTime) {
                updateTimer(d.startTime);
            }

            // تحديث الإجابات (أول 5 أسئلة فقط)
            if(currentQ <= 5) {
                document.getElementById('ans-pink').innerText = (d.answers && d.answers.pink) ? (d.answers.pink[currentQ] || '...') : '...';
                document.getElementById('ans-purple').innerText = (d.answers && d.answers.purple) ? (d.answers.purple[currentQ] || '...') : '...';
                document.getElementById('correction-area').style.opacity = "1";
            } else {
                document.getElementById('ans-pink').innerText = "Caché (Phase 2)";
                document.getElementById('ans-purple').innerText = "Caché (Phase 2)";
                document.getElementById('correction-area').style.opacity = "0.5";
            }

            if(d.showResults) displayWinner(d);
        });

        function updateTimer(startTime) {
            clearInterval(timerInt);
            timerInt = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const remaining = 60 - elapsed;
                
                if(remaining <= 0) {
                    document.getElementById('question-timer').innerText = "00:00";
                    document.getElementById('question-timer').style.color = "#ff4b2b";
                    clearInterval(timerInt);
                } else {
                    document.getElementById('question-timer').innerText = `00:${remaining.toString().padStart(2, '0')}`;
                    document.getElementById('question-timer').style.color = "#f1c40f";
                }
            }, 1000);
        }

        function displayWinner(d) {
            const isP = d.scorePink >= d.scorePurple;
            const name = isP ? d.teamPink : d.teamPurple;
            const color = isP ? "#ec4899" : "#9d50bb";
            
            document.getElementById('winner-overlay').style.display = 'flex';
            const frame = document.getElementById('winner-frame');
            frame.style.borderColor = color;
            frame.style.boxShadow = `0 0 60px ${color}`;
            
            const nEl = document.getElementById('winner-name');
            nEl.innerText = name || "CHAMPION";
            nEl.style.color = color;
            document.getElementById('winner-score').innerText = `SCORE: ${isP ? d.scorePink : d.scorePurple}`;
        }
    </script>
</body>
</html>
