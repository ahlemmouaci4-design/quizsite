// استبدل قسم الـ db.on القديم بهذا الكود المطور
db.on('value', snap => {
    const data = snap.val();
    if (!data) return;

    // 1. بدء المسابقة: فقط إذا سجلت اسمك ولم تبدأ بعد
    if (data.status === 'start' && myName && current === 0 && !timerInterval) {
        document.getElementById('waiting-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        startQuizTimer(data.startTime);
    }

    // 2. تحديث النتائج: إظهار النتيجة النهائية عند ضغط الأدمن
    if (data.showResults && myName) {
        if (!document.getElementById('quiz-screen').classList.contains('hidden')) {
            forceFinish(true);
        }
        // إظهار شاشة النتائج (تأكد من وجود الدوال السابقة لديك)
        showFinalResults(); 
    }

    // 3. إعادة الضبط (Reset): التحديث يحدث فقط إذا انتهت المسابقة تماماً
    // هذا يمنع إعادة التحميل التلقائي أثناء كتابة الاسم
    if (data.status === 'waiting' && myName !== '' && current > 0) {
        location.reload();
    }
});

